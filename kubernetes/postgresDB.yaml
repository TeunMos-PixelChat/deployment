# https://stackgres.io/
apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
type: Opaque
data:
  username: cG9zdGdyZXM=  # Base64 encoded 'postgres'
  password: ZXBpY1Bhc3N3b3Jk
---

apiVersion: stackgres.io/v1
kind: SGCluster
metadata:
  name: pixelchat-postgres-stackgres-cluster
spec:
  configurations:
    credentials:
      users:
        superuser:
          username:
            name: postgres-credentials
            key: username
          password:
            name: postgres-credentials
            key: password
  instances: 2
  postgres:
    version: 'latest'
  pods:
    persistentVolume:
      size: '5Gi'
  autoscaling:
    minInstances: 2
    maxInstances: 5
    maxAllowed:
      envoy:
        cpu: 400m
        memory: 1Gi
      patroni:
        cpu: 400m
        memory: 1Gi
      pgbouncer:
        cpu: 400m 
        memory: 1Gi
    minAllowed:
      envoy:
        cpu: 100m
        memory: 100Mi
      patroni:
        cpu: 100m
        memory: 100Mi
      pgbouncer:
        cpu: 100m
        memory: 100Mi